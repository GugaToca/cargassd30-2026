<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Logística • Gestão de Despacho</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- TOPBAR -->
  <header class="topbar">
    <div class="left">
      <button class="iconBtn" id="btnMenu" aria-label="Abrir menu">
        <span class="burger"></span>
      </button>

      <div class="brand">
        <div class="logo">LG</div>
        <div class="brandText">
          <strong>Gestão de Logística</strong>
          <small>Despacho • Cargas • Pedidos • Volumes</small>
        </div>
      </div>
    </div>

    <div class="right">
      <div id="userBadge" class="badge hidden"></div>
      <button id="btnLogout" class="btn btnGhost hidden">Sair</button>
    </div>
  </header>

  <!-- AUTH -->
  <main id="authView" class="page">
    <section class="authShell">
      <div class="authCard">
        <div class="authHeader">
          <h1>Entrar</h1>
          <p class="muted">Faça login para acessar o sistema.</p>
        </div>

        <div class="formGrid">
          <div class="field">
            <label>Email</label>
            <input id="loginEmail" type="email" placeholder="seuemail@exemplo.com" autocomplete="email" />
          </div>

          <div class="field">
            <label>Senha</label>
            <input id="loginPass" type="password" placeholder="••••••••" autocomplete="current-password" />
          </div>
        </div>

        <div class="row">
          <button id="btnLogin" class="btn">Entrar</button>
          <button id="btnRegister" class="btn btnOutline">Criar conta</button>
        </div>

        <div class="hint">
          <span id="authMsg" class="muted"></span>
        </div>
      </div>

      <div class="authSide">
        <div class="sideCard">
          <h2>Controle total do despacho</h2>
          <p class="muted">
            Cadastre transportadoras, crie cargas, adicione pedidos e volumes e acompanhe ocorrências com OK/ERRO.
          </p>

          <div class="miniStats">
            <div class="miniStat">
              <span class="dot ok"></span>
              <div>
                <strong>OK</strong>
                <small class="muted">cargas sem ocorrência</small>
              </div>
            </div>
            <div class="miniStat">
              <span class="dot err"></span>
              <div>
                <strong>ERRO</strong>
                <small class="muted">com divergência/avaria</small>
              </div>
            </div>
          </div>

          <div class="muted small">
            Dica: rode via Live Server (http://...) para módulos funcionarem direitinho.
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- APP -->
  <main id="appView" class="page hidden">
    <!-- overlay (mobile) -->
    <div class="overlay" id="overlay"></div>

    <div class="appLayout">
      <!-- SIDEBAR -->
      <aside class="sidebar" id="sidebar">
        <div class="sideTop">
          <h2>Navegação</h2>
          <button class="iconBtn closeBtn" id="btnCloseMenu" aria-label="Fechar menu">×</button>
        </div>

        <nav class="nav">
          <button class="navItem active" data-tab="dashboard">Dashboard</button>
          <button class="navItem" data-tab="transportadoras">Transportadoras</button>
          <button class="navItem" data-tab="cargas">Cargas</button>
          <button class="navItem" data-tab="relatorios">Relatórios</button>
          <button class="navItem" data-tab="config">Config</button>
        </nav>

        <div class="sideFooter">
          <div class="small muted">
            Dica: use “OK/ERRO” nas cargas para controle rápido.
          </div>
        </div>
      </aside>

      <!-- CONTENT -->
      <section class="content">
        <!-- DASHBOARD -->
        <section id="tab-dashboard" class="card tab">
          <div class="tabHeader">
            <div>
              <h1>Dashboard</h1>
              <p class="muted">Visão geral do despacho e status das cargas.</p>
            </div>
            <div class="pillRow">
              <span class="pill" id="kpiTotal">Total: 0</span>
              <span class="pill ok" id="kpiOk">OK: 0</span>
              <span class="pill err" id="kpiErr">ERRO: 0</span>
            </div>
          </div>

          <div class="gridAuto3">
            <div class="card inner">
              <div class="cardTitle">
                <h3>Últimas cargas</h3>
              </div>
              <div id="dashLastCargas" class="list"></div>
            </div>

            <div class="card inner">
              <div class="cardTitle">
                <h3>Transportadoras</h3>
              </div>
              <div id="dashTransportadoras" class="list"></div>
            </div>

            <div class="card inner">
              <div class="cardTitle">
                <h3>Alertas (ERRO)</h3>
              </div>
              <div id="dashErros" class="list"></div>
            </div>
          </div>
        </section>

        <!-- TRANSPORTADORAS -->
        <section id="tab-transportadoras" class="card tab hidden">
          <div class="tabHeader">
            <div>
              <h1>Transportadoras</h1>
              <p class="muted">Cadastre e gerencie transportadoras.</p>
            </div>
          </div>

          <div class="gridAuto2">
            <div class="card inner">
              <div class="cardTitle">
                <h3>Nova transportadora</h3>
                <p class="muted small">Cadastre nome, código e contato.</p>
              </div>

              <div class="formGrid">
                <div class="field">
                  <label>Nome</label>
                  <input id="tNome" placeholder="Ex: MV Transportes" />
                </div>
                <div class="field">
                  <label>Código (opcional)</label>
                  <input id="tCodigo" placeholder="Ex: MV-003" />
                </div>
                <div class="field">
                  <label>Contato (opcional)</label>
                  <input id="tContato" placeholder="Telefone / WhatsApp / Email" />
                </div>
              </div>

              <div class="row">
                <button id="btnAddTransportadora" class="btn">Salvar</button>
                <div id="tMsg" class="muted small"></div>
              </div>
            </div>

            <div class="card inner">
              <div class="rowBetween">
                <div class="cardTitle">
                  <h3>Lista</h3>
                  <p class="muted small">Busque e edite rapidamente.</p>
                </div>
                <input id="tSearch" class="inputSm" placeholder="Buscar..." />
              </div>
              <div id="transportadorasList" class="tableWrap mt12"></div>
            </div>
          </div>
        </section>

        <!-- CARGAS -->
        <section id="tab-cargas" class="card tab hidden">
          <div class="tabHeader">
            <div>
              <h1>Cargas</h1>
              <p class="muted">Crie cargas, vincule pedidos e controle volumes e problemas.</p>
            </div>
          </div>

          <div class="gridAuto2">
            <div class="card inner">
              <div class="cardTitle">
                <h3>Nova carga</h3>
                <p class="muted small">Dados essenciais do despacho.</p>
              </div>

              <div class="gridAuto2">
                <div class="field">
                  <label>Carga</label>
                  <input id="cPlaca" placeholder="ABC-1D23" />
                </div>

              <div class="gridAuto2">
                <div class="field">
                  <label>Transportadora</label>
                  <select id="cTransportadora"></select>
                </div>
                <div class="field">
                  <label>Data do despacho</label>
                  <input id="cData" type="date" />
                </div>
              </div>

<div class="gridAuto2">
  <div class="field">
    <label>Pedidos (inicial)</label>
    <input id="cPedidos" type="number" min="0" value="0" placeholder="0" />
  </div>
  <div class="field">
    <label>Volumes (inicial)</label>
    <input id="cVolumes" type="number" min="0" value="0" placeholder="0" />
  </div>
</div>


                <div class="field">
                  <label>Motorista (opcional)</label>
                  <input id="cMotorista" placeholder="Nome do motorista" />
                </div>
              </div>

              <div class="gridAuto2">
                <div class="field">
                  <label>Status do problema</label>
                  <select id="cProblema">
                    <option value="OK">OK</option>
                    <option value="ERRO">ERRO</option>
                  </select>
                </div>
                <div class="field">
                  <label>Observação (se ERRO, explique)</label>
                  <input id="cObs" placeholder="Ex: Avaria / divergência / falta volume..." />
                </div>
              </div>

              <div class="row">
                <button id="btnAddCarga" class="btn">Criar carga</button>
                <div id="cMsg" class="muted small"></div>
              </div>
            </div>

            <div class="card inner">
              <div class="rowBetween">
                <div class="cardTitle">
                  <h3>Cargas criadas</h3>
                  <p class="muted small">Filtre e abra para editar pedidos/volumes.</p>
                </div>
                <button id="btnRefreshCargas" class="btn btnGhost">Atualizar</button>
              </div>

              <div class="gridAuto3 mt12">
                <div class="field">
                  <label>Status</label>
                  <select id="fStatus">
                    <option value="TODOS">Todos</option>
                    <option value="OK">OK</option>
                    <option value="ERRO">ERRO</option>
                  </select>
                </div>
                <div class="field">
                  <label>Transportadora</label>
                  <select id="fTransportadora"></select>
                </div>
                <div class="field">
                  <label>Busca</label>
                  <input id="fBusca" placeholder="Placa, motorista, obs..." />
                </div>
              </div>

              <!-- Aqui o app.js desenha cards/tabela -->
              <div id="cargasList" class="cardsWrap mt12"></div>
            </div>
          </div>

          <div class="card inner mt16">
            <div class="rowBetween">
              <div>
                <h3>Detalhes da carga</h3>
                <div class="muted small">Selecione uma carga na lista acima para editar pedidos/volumes.</div>
              </div>
              <div class="row">
                <button id="btnCloseDetail" class="btn btnOutline">Fechar</button>
                <button id="btnDeleteCarga" class="btn btnDanger hidden">Excluir carga</button>
              </div>
            </div>

            <div id="cargaDetail" class="hidden mt12">
              <div class="detailGrid">
                <div class="card inner">
                  <div class="cardTitle">
                    <h4>Resumo</h4>
                  </div>
                  <div id="detailResumo" class="kv"></div>

                  <div class="row mt12">
                    <button id="btnToggleProblema" class="btn btnGhost">Alternar OK/ERRO</button>
                    <button id="btnEditObs" class="btn btnGhost">Editar observação</button>
                  </div>
                </div>

                <div class="card inner">
                  <div class="cardTitle">
                    <h4>Novo pedido</h4>
                  </div>

                  <div class="gridAuto2">
                    <div class="field">
                      <label>Nº do pedido</label>
                      <input id="pNumero" placeholder="Ex: 154987" />
                    </div>
                    <div class="field">
                      <label>Cliente (opcional)</label>
                      <input id="pCliente" placeholder="Ex: Mercado X" />
                    </div>
                  </div>

                  <div class="gridAuto2">
                    <div class="field">
                      <label>Volumes</label>
                      <input id="pVolumes" type="number" min="0" placeholder="0" />
                    </div>
                    <div class="field">
                      <label>Observação (opcional)</label>
                      <input id="pObs" placeholder="Ex: frágil / prioridade" />
                    </div>
                  </div>

                  <div class="row">
                    <button id="btnAddPedido" class="btn">Adicionar pedido</button>
                    <div id="pMsg" class="muted small"></div>
                  </div>
                </div>

                <div class="card inner">
                  <div class="cardTitle">
                    <h4>Pedidos na carga</h4>
                  </div>
                  <div id="pedidosList" class="tableWrap mt12"></div>
                </div>
              </div>
            </div>

            <div id="detailEmpty" class="empty mt12">
              Nenhuma carga selecionada.
            </div>
          </div>
        </section>

        <!-- RELATORIOS -->
        <section id="tab-relatorios" class="card tab hidden">
          <div class="tabHeader">
            <div>
              <h1>Relatórios</h1>
              <p class="muted">Exportação simples e contagens por período.</p>
            </div>
          </div>

          <div class="gridAuto3">
            <div class="field">
              <label>De</label>
              <input id="rDe" type="date" />
            </div>
            <div class="field">
              <label>Até</label>
              <input id="rAte" type="date" />
            </div>
            <div class="field">
              <label>Ação</label>
              <button id="btnGerarRelatorio" class="btn w100">Gerar</button>
            </div>
          </div>

          <div class="card inner mt16">
            <div class="rowBetween">
              <div class="cardTitle">
                <h3>Resultado</h3>
                <p class="muted small">Você pode exportar em CSV.</p>
              </div>
              <button id="btnExportCSV" class="btn btnOutline hidden">Exportar CSV</button>
            </div>

            <div id="relatorioResumo" class="muted small mt12"></div>
            <div id="relatorioTabela" class="tableWrap mt12"></div>
          </div>
        </section>

        <!-- CONFIG -->
        <section id="tab-config" class="card tab hidden">
          <div class="tabHeader">
            <div>
              <h1>Config</h1>
              <p class="muted">Coleções e regras (referência rápida).</p>
            </div>
          </div>

          <div class="card inner">
            <div class="cardTitle">
              <h3>Modelo de dados (Firestore)</h3>
            </div>
            <pre class="codeBlock">transportadoras (collection)
  - nome (string)
  - codigo (string)
  - contato (string)
  - createdAt (timestamp)
  - updatedAt (timestamp)

cargas (collection)
  - transportadoraId (string)
  - transportadoraNome (string)
  - dataDespacho (string YYYY-MM-DD)
  - placa (string)
  - motorista (string)
  - problema (string: "OK" | "ERRO")
  - observacao (string)
  - totalPedidos (number)
  - totalVolumes (number)
  - createdAt (timestamp)
  - updatedAt (timestamp)

cargas/{cargaId}/pedidos (subcollection)
  - numero (string)
  - cliente (string)
  - volumes (number)
  - observacao (string)
  - createdAt (timestamp)
  - updatedAt (timestamp)</pre>
          </div>

          <div class="card inner mt16">
            <div class="cardTitle">
              <h3>Regras sugeridas (Security Rules)</h3>
            </div>
            <p class="muted small">Cole no Firebase Console &gt; Firestore Rules.</p>
            <pre class="codeBlock">rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function signedIn() { return request.auth != null; }

    match /transportadoras/{docId} {
      allow read, write: if signedIn();
    }

    match /cargas/{cargaId} {
      allow read, write: if signedIn();

      match /pedidos/{pedidoId} {
        allow read, write: if signedIn();
      }
    }
  }
}</pre>
          </div>
        </section>

      </section>
    </div>
  </main>

  <footer class="footer">
    <small class="muted">© <span id="year"></span> • Sistema de Gestão de Logística</small>
  </footer>

  <!-- mantém seu app.js intacto -->
  <script type="module" src="app.js"></script>

  <!-- JS leve só pro menu mobile (não encosta no app.js) -->
  <script>
    (function(){
      const btnMenu = document.getElementById("btnMenu");
      const btnClose = document.getElementById("btnCloseMenu");
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("overlay");

      function openMenu(){
        document.body.classList.add("menuOpen");
      }
      function closeMenu(){
        document.body.classList.remove("menuOpen");
      }

      if(btnMenu) btnMenu.addEventListener("click", openMenu);
      if(btnClose) btnClose.addEventListener("click", closeMenu);
      if(overlay) overlay.addEventListener("click", closeMenu);

      // fecha menu ao clicar em um item (mobile)
      document.addEventListener("click", (e) => {
        const t = e.target;
        if(t && t.classList && t.classList.contains("navItem")) closeMenu();
      });
    })();
  </script>
</body>
</html>
